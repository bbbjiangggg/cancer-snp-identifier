<!DOCTYPE html>
<html>
<head>
    <title>ImageJ Live Cell Count</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet"> 
    <style>
        body {
            background-color: #20011f8c;
            font-family: 'Ubuntu', sans-serif;
            color: white;
            text-align: center;
            font-weight: bold;
        }

        .banner {
            background-color: #5f1069;
            color: white;
            padding: 20px;
            font-size: 60px;
            text-shadow: 4px 4px 2px rgba(0,0,0,0.5);
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
        }

        .container {
            width: 33%;
            margin: 0 auto;
            padding: 40px; /* Increased padding for more space inside the container */
            background-color: #4f0f59;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            text-align: center;
            color: white;
            border-radius: 8px;
            overflow: hidden; /* Ensure no overflow from the container */
        }

        input[type="number"], input[type="text"], input[type="file"], label, legend {
            display: block; /* Make elements block to occupy full width */
            width: calc(100% - 20px); /* Adjust width to account for padding */
            padding: 10px; /* Increased padding for more space around text */
            margin: 15px auto; /* Increased margin for more space between elements */
            border: 1px solid #cccccc;
            border-radius: 4px;
            font-weight: bold;
            box-sizing: border-box; /* Ensure padding does not add to the width */
        }

        input[type="submit"], button {
            margin-top: 20px; /* Additional margin for spacing between buttons and fields */
            background-color: #00008B;
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        input[type="submit"]:hover, button:hover {
            opacity: 0.8;
        }

        #results, #error {
            margin-top: 20px;
            font-weight: bold;
        }

        #error {
            background-color: black;
            padding: 10px;
            border-radius: 5px;
            display: none; /* Initially hide the error box */
        }
        
        fieldset {
            border: none; /* Remove fieldset border for cleaner appearance */
            margin: 20px 0; /* Added margin around fieldsets for better spacing */
        }

        legend {
            font-size: 1.2em; /* Increase legend font size for better visibility */
            margin-bottom: 15px; /* Space below legend */
        }
    </style>
</head>
<body>
    <div class="banner">Cancer Immunology</div>

    <div class="container">
        <h1>ImageJ Live Cell Count</h1>

        <!-- Browse Button -->
        <input type="file" id="fileInput" accept=".csv">
        <br><br>

        <!-- Cell Concentration Calculator -->
        <fieldset>
            <label for="area">Area of Imaged Field (µm²):</label>
            <input type="number" id="area" name="area">
        
            <label for="count1">Number of Cells Counted (Count 1):</label>
            <input type="number" id="count1" name="count1">
        
            <label for="count2">Number of Cells Counted (Count 2, optional):</label>
            <input type="number" id="count2" name="count2">
            
            <label for="count3">Number of Cells Counted (Count 3, optional):</label>
            <input type="number" id="count3" name="count3">
            
            <label for="count4">Number of Cells Counted (Count 4, optional):</label>
            <input type="number" id="count4" name="count4">
        
            <button onclick="calculateCellsPerML()">Calculate</button>
            &nbsp;
            <button onclick="clearData()">Clear</button>
            <!-- Display results here -->
            <div id="calculationResult" style="margin-top: 20px;"></div>
        </fieldset>
        

        <!-- Cell Count and Concentration Calculator -->
        <fieldset>
            <legend>For Seeding Density:</legend>
            <form id="calculatorForm">
                <label for="liveCount">Live count:</label>
                <input type="text" id="liveCount" name="liveCount">
        
                <label for="desiredConcentration">Desired cell concentration in cells/mL <br> (e.g., 3e6 or 3 x 10^6):</label>
                <input type="text" id="desiredConcentration" name="desiredConcentration" placeholder="e.g., 3e6, 3 x 10^6">

        
                <label for="volume">Desired volume (ml):</label>
                <input type="text" id="volume" name="volume">
        
                <input type="submit" value="Calculate">
                <!-- "Clear" button added here for the second section -->
                <button type="button" onclick="clearSecondForm()">Clear</button>
            </form>
        </fieldset>
        

        <div id="results"></div>
        <div id="error"></div>
    </div>

    <script>
        function calculateCellsPerML() {
            var area = document.getElementById('area').value;
            var counts = [
                document.getElementById('count1').value,
                document.getElementById('count2').value,
                document.getElementById('count3').value,
                document.getElementById('count4').value,
            ].map(Number).filter(Boolean);
            var averageCount = counts.reduce((acc, val) => acc + val, 0) / counts.length;
            var depthOfField = 30; // Assuming a fixed depth of field
            var dilutionFactor = 2; // Assuming a fixed dilution factor
            var volumeImagedML = (area * depthOfField) / 1e12; // Corrected for volume in mL
            var cellsPerML = (averageCount / volumeImagedML) * dilutionFactor;
            var scientificNotation = cellsPerML.toExponential(2); // Simplified scientific notation
    
            document.getElementById('calculationResult').innerHTML = "Live Cell Count: " + scientificNotation + " cells/mL";
            document.getElementById('liveCount').value = scientificNotation; // Automatically update live count
        }
    
        function clearData() {
            document.getElementById('area').value = '';
            document.getElementById('count1').value = '';
            document.getElementById('count2').value = '';
            document.getElementById('count3').value = '';
            document.getElementById('count4').value = '';
            document.getElementById('calculationResult').innerHTML = '';
        }
    
        function clearSecondForm() {
            document.getElementById('liveCount').value = '';
            document.getElementById('desiredConcentration').value = '';
            document.getElementById('volume').value = '';
            document.getElementById('results').innerHTML = '';
            document.getElementById('error').style.display = 'none';
        }

        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const contents = e.target.result;
                const lines = contents.split('\n').filter(Boolean);
                // Assuming the first line contains headers and subsequent lines contain data
                for (let i = 1; i < lines.length && i <= 5; i++) {
                    const line = lines[i].split('\t');
                    // Assuming CSV format: Area Mean Min Max Count
                    document.getElementById(`count${i}`).value = line[4].trim(); // Set count value
                }
                // Optionally set the area field if needed
                document.getElementById('area').value = lines[1].split('\t')[0].trim(); // Set area value from the first data row
            };
            reader.readAsText(file);
        });

        window.onload = function() {
            document.getElementById('calculatorForm').reset();
        };
    </script>
</body>
</html>
